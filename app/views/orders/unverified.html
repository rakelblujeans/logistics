<h3>Unverified Orders</h3>
<br />
<p>Please verify the orders below so we can move them into the delivery queue.</p>
<a href="#/orders/new">Add +</a> | 
<a href="#/orders/unshipped">View unshipped orders</a></p>
<br />

<!-- TODO: add tab for verified orders -->

<table class="table table-striped table-hover table-responsive">
<thead>
<tr>
	<th ng-class="{ascending: sort.column == 'shipping_name' && !sort.descending, 
								 descending: sort.column == 'shipping_name' && sort.descending}" ng-click="changeSorting('shipping_name')">
		Customer Name <span ng-show="sort.column == 'shipping_name'"> {{ sort.descending | sortOrderIcon }}</span>
	</th>
	<th ng-class="{ascending: sort.column == 'full_address' && !sort.descending, 
								 descending: sort.column == 'full_address' && sort.descending}" ng-click="changeSorting('full_address')">
		Shipping Address <span ng-show="sort.column == 'full_address'"> {{ sort.descending | sortOrderIcon }}</span>
	</th>
	<th ng-class="{ascending: sort.column == 'arrival_date' && !sort.descending, 
								 descending: sort.column == 'arrival_date' && sort.descending}" ng-click="changeSorting('arrival_date')">
		Arrival <span ng-show="sort.column == 'arrival_date'"> {{ sort.descending | sortOrderIcon }}</span>
	</th>
	<th ng-class="{ascending: sort.column == 'departure_date' && !sort.descending, 
								 descending: sort.column == 'departure_date' && sort.descending}" ng-click="changeSorting('departure_date')">
		Departure <span ng-show="sort.column == 'departure_date'"> {{ sort.descending | sortOrderIcon }}</span>
	</th>
	<th ng-class="{ascending: sort.column == 'assignedPhones' && !sort.descending, 
								 descending: sort.column == 'assignedPhones' && sort.descending}" ng-click="changeSorting('assignedPhones')">
		Assigned Phones <span ng-show="sort.column == 'assignedPhones'"> {{ sort.descending | sortOrderIcon }}</span>
	</th>
	<th>Options</th>
</tr>
</thead>
<tbody>
<tr ng-repeat="order in orders | filter:query | orderBy:sort.column:sort.descending">
	<td>{{ order.shipping_name }}</td>
	<td>{{ order.full_address }}</td>
	<td>{{ order.arrival_date }}</td>
	<td>{{ order.departure_date }}</td>
	<td>{{ data[order.id].assignedPhoneIds }}</td>
	<td>
		<a href="#/orders/{{order.id}}">Inspect</a> |<br />
		<!-- Button trigger modal -->
		<button type="button" class="btn btn-xs btn-default" 
			data-toggle="modal" data-target="#myModal"
			ng-click="showInventoryOptions(order)">
		  Adjust phones
		</button>
		<br />
		<button type="button" class="btn btn-xs btn-success" 
			ng-click="verifyOrder(order)">
		  Mark verified
		</button>
		
		<!-- Modal -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
		        <h4 class="modal-title" id="myModalLabel">Assign Phones</h4>
		      </div>
		      <div class="modal-body">
		        <p>
		        	Currently assigned: {{order.slotsAvailable == order.num_phones ? 'none' : ''}}
							<button ng-repeat="phoneSlot in data[order.id].phoneSlots"
								ng-if="phoneSlot" 
								type="button" class="btn btn-xs btn-default"
								ng-click="unassignDevice(order, phoneSlot.id)">
									{{ phoneSlot.inventory_id}} &nbsp;<span class="glyphicon glyphicon-remove"></span>
							</button>
						</p>

						<div ng-if="data[order.id].slotsAvailable > 0">
							<p>You have {{data[order.id].slotsAvailable}} open slot(s). Assign the next:</p>
				      <select class="dropdown"
				          name="assign"
				          ng-model="order.assignedInventoryItem"
				          ng-options="it.id as it.inventory_id for it in data[order.id].availableInventory">
				          <option value="">Select...</option>
				      </select>
							<button type="button" class="btn btn-xs btn-primary" ng-click="assignDevice(order)">
								<span class="glyphicon glyphicon-ok"></span>
							</button>
						</div>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        <button type="button" class="btn btn-success" 
		        	data-dismiss="modal"
							ng-if="!data[order.id].slotsAvailable"
							ng-click="verifyOrder(order)">
							Mark verified &nbsp;<span class="glyphicon glyphicon-thumbs-up"></span>
						</button>
						
		      </div>
		    </div>
		  </div>
		</div><!-- end Modal -->
	</td>
</tr>
</tbody>
</table>
